<!DOCTYPE html>
<html lang="es" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SamaruC Code</title>
    
    <!-- MÃºltiples formatos de favicon para mejor compatibilidad -->
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="assets/icon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="assets/icon-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="assets/icon-48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="assets/icon-64.png">
    <link rel="apple-touch-icon" sizes="128x128" href="assets/icon-128.png">
    
    <!-- Aplicar tema inmediatamente antes de cargar CSS -->
    <script>
        document.documentElement.setAttribute('data-theme', 'dark');
        document.documentElement.style.backgroundColor = '#1e1e1e';
        document.documentElement.style.color = '#d4d4d4';
    </script>
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Barra de herramientas -->
        <div class="toolbar">
            
            <div class="toolbar-section">
                <button id="new-file-btn" class="btn btn-secondary tooltip" title="Nuevo archivo (Ctrl+N)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zM4 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5L9.5 1H4z"/>
                            <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3zM8.5 6.5a.5.5 0 0 0-1 0V8H6a.5.5 0 0 0 0 1h1.5v1.5a.5.5 0 0 0 1 0V9H10a.5.5 0 0 0 0-1H8.5V6.5z"/>
                        </svg>
                    </span>
                </button>
                <button id="open-file-btn" class="btn btn-secondary tooltip" title="Abrir archivo (Ctrl+O)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5V6.5L10.5 0H1.5z"/>
                            <path d="M11 0v4.5A1.5 1.5 0 0 0 12.5 6H16v-1L11 0z"/>
                        </svg>
                    </span>
                </button>
                <button id="save-file-btn" class="btn btn-secondary tooltip" title="Guardar (Ctrl+S)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zM4 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V4.5L9.5 1H4z"/>
                            <path d="M9.5 3V0L14 4.5h-3A1.5 1.5 0 0 1 9.5 3z"/>
                        </svg>
                    </span>
                </button>
            </div>
            <div class="toolbar-section">
                <button id="cut-btn" class="btn btn-secondary tooltip" title="Cut (Ctrl+X)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M3.5 3.5c-.614-.884-.074-1.962.858-2.5L8 7.226 11.642 1c.932.538 1.472 1.616.858 2.5L8.81 8.61l1.556 2.661a2.5 2.5 0 1 1-.794.637L8 9.73l-1.572 2.177a2.5 2.5 0 1 1-.794-.637L7.19 8.61 3.5 3.5zm2.5 10a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0zm7 0a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0z"/>
                        </svg>
                    </span>
                </button>
                <button id="copy-btn" class="btn btn-secondary tooltip" title="Copy (Ctrl+C)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
                            <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
                        </svg>
                    </span>
                </button>
                <button id="paste-btn" class="btn btn-secondary tooltip" title="Paste (Ctrl+V)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8.5 1a.5.5 0 0 0-1 0v1.5H6a.5.5 0 0 0 0 1h1.5V5a.5.5 0 0 0 1 0V3.5H10a.5.5 0 0 0 0-1H8.5V1z"/>
                            <path d="M3 0h10a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-1h1v1a1 1 0 0 0 1 1h10a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v1H1V2a2 2 0 0 1 2-2z"/>
                            <path d="M1 5v-.5a.5.5 0 0 1 1 0V5h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V8h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1zm0 3v-.5a.5.5 0 0 1 1 0V11h.5a.5.5 0 0 1 0 1h-2a.5.5 0 0 1 0-1H1z"/>
                        </svg>
                    </span>
                </button>
            </div>
            <div class="toolbar-section">
                <button id="compile-btn" class="btn btn-secondary tooltip" title="Compilar (F5)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8.5 1a.5.5 0 0 0-1 0v1.5H6a.5.5 0 0 0 0 1h1.5V5a.5.5 0 0 0 1 0V3.5H10a.5.5 0 0 0 0-1H8.5V1zM3 9.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm2.5 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm2.5 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm2.5 0a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1zm0 2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-1a.5.5 0 0 1-.5-.5v-1z"/>
                        </svg>
                    </span> 
                </button>
                <button id="run-btn" class="btn btn-secondary tooltip" title="Compilar y Ejecutar (F6)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="M6.271 5.055a.5.5 0 0 1 .52.038L11 7.055a.5.5 0 0 1 0 .89L6.791 9.907a.5.5 0 0 1-.791-.389V5.48a.5.5 0 0 1 .271-.425z"/>
                        </svg>
                    </span>
                </button>
            </div>
            <div class="toolbar-section">
                <button id="search-btn" class="btn btn-secondary tooltip" title="Buscar (Ctrl+F)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                        </svg>
                    </span>
                </button>
                <button id="find-replace-btn" class="btn btn-secondary tooltip" title="Buscar y Reemplazar (Ctrl+H)">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
                            <path d="M2.5 7.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm0 2a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                    </span>
                </button>
            </div>
            <div class="toolbar-section">
                <button id="gameboy-btn" class="btn btn-secondary tooltip" title="Gameboy Mode">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h11a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-11zm0 1h11a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5z"/>
                            <rect x="4" y="4" width="8" height="5" rx="0.5"/>
                            <circle cx="5" cy="11" r="0.8"/>
                            <circle cx="11" cy="11" r="0.8"/>
                            <rect x="3" y="10.5" width="2" height="0.5"/>
                            <rect x="11" y="10.5" width="2" height="0.5"/>
                            <rect x="2.5" y="10.5" width="0.5" height="2"/>
                            <rect x="13" y="10.5" width="0.5" height="2"/>
                        </svg>
                    </span>
                </button>
                <button id="spectrum-btn" class="btn btn-secondary tooltip" title="ZX Spectrum Mode">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M1 3a1 1 0 0 1 1-1h12a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V3zm1 0v10h12V3H2z"/>
                            <rect x="3" y="4" width="10" height="6" rx="0.5"/>
                            <rect x="3" y="11" width="1.5" height="1"/>
                            <rect x="5" y="11" width="1.5" height="1"/>
                            <rect x="7" y="11" width="1.5" height="1"/>
                            <rect x="9" y="11" width="1.5" height="1"/>
                            <rect x="11.5" y="11" width="1.5" height="1"/>
                            <circle cx="8" cy="7" r="1" fill="none" stroke="currentColor" stroke-width="0.5"/>
                        </svg>
                    </span>
                </button>
                <button id="basic-btn" class="btn btn-secondary tooltip" title="BASIC Terminal Mode">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <rect x="1" y="2" width="14" height="12" rx="1" fill="none" stroke="currentColor" stroke-width="1"/>
                            <rect x="2" y="3" width="12" height="10" fill="currentColor"/>
                            <circle cx="4" cy="5" r="0.5" fill="white"/>
                            <rect x="5" y="4.5" width="7" height="1" fill="white"/>
                            <circle cx="4" cy="7" r="0.5" fill="white"/>
                            <rect x="5" y="6.5" width="5" height="1" fill="white"/>
                            <circle cx="4" cy="9" r="0.5" fill="white"/>
                            <rect x="5" y="8.5" width="6" height="1" fill="white"/>
                            <circle cx="4" cy="11" r="0.5" fill="white"/>
                            <rect x="5" y="10.5" width="4" height="1" fill="white"/>
                            <rect x="3" y="12.5" width="1" height="0.5" fill="white"/>
                        </svg>
                    </span>
                </button>
            </div>
        </div>

        <!-- Panel principal -->
        <div class="main-panel">
            <!-- Explorador de archivos -->
            <div class="sidebar">
                <div class="sidebar-header">
                    <h3>
                        <span class="icon">
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                <path d="M.5 3l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8H16l.305-3.234A2 2 0 0 0 14.31 3H9.5l-1-1h-5A1 1 0 0 0 .5 3z"/>
                                <path d="M9.5 10.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-3z"/>
                            </svg>
                        </span> Explorador
                    </h3>
                </div>
                <div class="file-explorer" id="file-explorer">
                    <div class="no-project">
                        <p>No hay proyecto abierto</p>
                        <button id="open-project-btn" class="btn btn-secondary">
                            <span class="icon">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                                    <path d="M.5 3l.04.87a1.99 1.99 0 0 0-.342 1.311l.637 7A2 2 0 0 0 2.826 14H9v-1H2.826a1 1 0 0 1-.995-.91l-.637-7A1 1 0 0 1 2.19 4h11.62a1 1 0 0 1 .996 1.09L14.54 8H16l.305-3.234A2 2 0 0 0 14.31 3H9.5l-1-1h-5A1 1 0 0 0 .5 3z"/>
                                    <path d="M9.5 10.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-3z"/>
                                </svg>
                            </span> Abrir Proyecto
                        </button>
                    </div>
                </div>
            </div>

            <!-- Editor -->
            <div class="editor-container">
                <div class="editor-header">
                    <div class="editor-title">
                        <span class="icon">ð</span>
                        <span id="current-file-name">Editor de cÃ³digo</span>
                    </div>
                    <div class="editor-actions">
                        <button id="new-file-btn" class="btn btn-small" title="Nuevo archivo">Nuevo</button>
                        <button id="open-file-btn" class="btn btn-small" title="Abrir archivo">Abrir</button>
                        <button id="save-file-btn" class="btn btn-small" title="Guardar">Guardar</button>
                    </div>
                </div>
                <div class="editor-content">
                    <div id="monaco-editor" class="monaco-editor-container">
                        <!-- Monaco Editor se carga aquÃ­ -->
                        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; background: #1E1E1E; color: #D4D4D4;">
                            <div style="background: #2d2d30; padding: 8px 12px; border-bottom: 1px solid #3e3e42; font-size: 13px; display: flex; justify-content: space-between;">
                                <span style="color: #ffffff;">ð SamaruC Code - Editor C</span>
                                <span id="editor-status" style="color: #ffa500; font-size: 11px;">Cargando Monaco...</span>
                            </div>
                            <div id="monaco-loading" style="flex: 1; display: flex; align-items: center; justify-content: center; color: #ffffff;">
                                <div style="text-align: center;">
                                    <div style="font-size: 24px; margin-bottom: 10px;">ð</div>
                                    <div>Cargando Monaco Editor...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Panel inferior -->
        <div class="bottom-panel">
            <div class="panel-tabs">
                <button class="panel-tab active" data-panel="output">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2zm13 2.383-4.758 2.855L15 11.114v-5.73zm-.034 6.878L9.271 8.82 8 9.583 6.728 8.82l-5.694 3.44A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.739zM1 11.114l4.758-2.876L1 5.383v5.73z"/>
                        </svg>
                    </span> Salida
                </button>
                <button class="panel-tab" data-panel="terminal">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M0 3a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3zm2-1a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"/>
                            <path d="M6 4.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zM6 7a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 6 7zm0 2.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5z"/>
                        </svg>
                    </span> Terminal
                </button>
                <button class="panel-tab" data-panel="problems">
                    <span class="icon">
                        <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/>
                        </svg>
                    </span> Problemas
                </button>
            </div>
            <div class="panel-content">
                <div id="output-panel" class="panel-section active">
                    <div id="output-content" class="console-output">
                        <div class="output-line success">ð SamaruC Code iniciado - Monaco Editor cargando...</div>
                    </div>
                </div>
                <div id="terminal-panel" class="panel-section">
                    <div id="terminal-content" class="terminal-output">
                        <!-- Terminal integrada -->
                        <!-- BotÃ³n temporal de debug -->
                        <div style="position: absolute; top: 5px; right: 5px; z-index: 1000;">
                            <button onclick="debugTerminalStatus(); console.log('Debug terminal ejecutado')" style="background: #ff6b6b; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; margin-right: 4px;">ð Debug</button>
                            <button onclick="testTerminalSwitch()" style="background: #4CAF50; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px; margin-right: 4px;">ð§ª Test</button>
                            <button onclick="testCompileDialog()" style="background: #2196F3; color: white; border: none; padding: 4px 8px; border-radius: 3px; font-size: 11px;">ð¨ Test SDK</button>
                        </div>
                    </div>
                </div>
                <div id="problems-panel" class="panel-section">
                    <div id="problems-content" class="problems-list">
                        <div class="no-problems">No hay problemas detectados</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- DiÃ¡logos HTML personalizados -->
    <div id="compile-sdk-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-container">
            <div class="dialog-header">
                <h3>ð¨ Seleccionar SDK de CompilaciÃ³n</h3>
                <button class="dialog-close" onclick="closeCompileDialog()">&times;</button>
            </div>
            <div class="dialog-content">
                <p>Â¿Con quÃ© SDK deseas compilar el proyecto?</p>
                <p class="dialog-subtitle">Selecciona el kit de desarrollo para la compilaciÃ³n del cÃ³digo C.</p>
                
                <div class="sdk-options">
                    <div class="sdk-option" data-sdk="gameboy">
                        <span class="sdk-icon">ð®</span>
                        <div class="sdk-info">
                            <strong>Gameboy SDK</strong>
                            <p>GBDK-N para desarrollo de Game Boy</p>
                        </div>
                    </div>
                    <div class="sdk-option" data-sdk="spectrum">
                        <span class="sdk-icon">ð»</span>
                        <div class="sdk-info">
                            <strong>ZX Spectrum SDK</strong>
                            <p>Z88DK para desarrollo en ZX Spectrum</p>
                        </div>
                    </div>
                    <div class="sdk-option" data-sdk="basic">
                        <span class="sdk-icon">ð¾</span>
                        <div class="sdk-info">
                            <strong>BASIC Compiler</strong>
                            <p>BAS2TAP para programas BASIC</p>
                        </div>
                    </div>
                    <div class="sdk-option" data-sdk="gcc">
                        <span class="sdk-icon">ð§</span>
                        <div class="sdk-info">
                            <strong>GCC/MinGW</strong>
                            <p>Compilador C estÃ¡ndar multiplataforma</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeCompileDialog()">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="compile-options-dialog" class="dialog-overlay" style="display: none;">
        <div class="dialog-container">
            <div class="dialog-header">
                <h3 id="options-dialog-title">âï¸ Opciones de CompilaciÃ³n</h3>
                <button class="dialog-close" onclick="closeOptionsDialog()">&times;</button>
            </div>
            <div class="dialog-content">
                <p>Selecciona las opciones de compilaciÃ³n:</p>
                
                <div class="compile-options">
                    <div class="compile-option" data-option="compile_run">
                        <span class="option-icon">ð</span>
                        <div class="option-info">
                            <strong>Compilar y Ejecutar</strong>
                            <p>Compila el cÃ³digo y ejecuta automÃ¡ticamente</p>
                        </div>
                    </div>
                    <div class="compile-option" data-option="compile_only">
                        <span class="option-icon">ð¨</span>
                        <div class="option-info">
                            <strong>Solo Compilar</strong>
                            <p>Genera Ãºnicamente el archivo compilado</p>
                        </div>
                    </div>
                    <div class="compile-option" data-option="debug">
                        <span class="option-icon">ð</span>
                        <div class="option-info">
                            <strong>Debug Mode</strong>
                            <p>CompilaciÃ³n con sÃ­mbolos de debug</p>
                        </div>
                    </div>
                    <div class="compile-option" data-option="release">
                        <span class="option-icon">ð¦</span>
                        <div class="option-info">
                            <strong>Release Mode</strong>
                            <p>CompilaciÃ³n optimizada para distribuciÃ³n</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dialog-footer">
                <button class="btn btn-secondary" onclick="closeOptionsDialog()">Cancelar</button>
            </div>
        </div>
    </div>

    <script>
        // ===== APLICAR TEMA INMEDIATAMENTE =====
        (function() {
            console.log('ð¨ Aplicando tema oscuro inmediatamente...');
            document.documentElement.setAttribute('data-theme', 'dark');
            document.body.style.backgroundColor = '#1e1e1e';
            document.body.style.color = '#d4d4d4';
        })();
        
        // ===== GESTIÃN DE TEMAS =====
        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            console.log('ð¨ Aplicando tema:', theme);
            
            // Forzar colores especÃ­ficos
            if (theme === 'dark') {
                document.body.style.backgroundColor = '#1e1e1e';
                document.body.style.color = '#d4d4d4';
                document.documentElement.style.backgroundColor = '#1e1e1e';
            }
            
            // Actualizar Monaco si estÃ¡ disponible
            if (window.monacoInstance) {
                const monacoTheme = theme === 'dark' ? 'vs-dark' : 'vs';
                window.monaco.editor.setTheme(monacoTheme);
            }
            
            addOutputLine(`ð¨ Tema cambiado a: ${theme}`, 'info');
        }
        
        // ===== FUNCIÃN DE PRUEBA =====
        function testCompileDialog() {
            console.log('ð§ª Probando diÃ¡logo de compilaciÃ³n...');
            if (window.showCompileSdkDialog) {
                window.showCompileSdkDialog().then(result => {
                    console.log('ð¨ Resultado del diÃ¡logo SDK:', result);
                    if (!result.canceled) {
                        console.log('ð¯ SDK seleccionado:', result.name);
                        addOutputLine(`ð¯ SDK seleccionado: ${result.name}`, 'success');
                    }
                });
            } else {
                console.error('â showCompileSdkDialog no estÃ¡ disponible');
                addOutputLine('â showCompileSdkDialog no estÃ¡ disponible', 'error');
            }
        }
        
        // ===== FUNCIONES DE DIÃLOGOS HTML =====
        window.showCompileSdkDialog = function() {
            console.log('ð¨ showCompileSdkDialog llamada');
            return new Promise((resolve) => {
                console.log('ð¨ Configurando resolve para SDK dialog');
                sdkDialogResolve = resolve;
                const dialog = document.getElementById('compile-sdk-dialog');
                console.log('ð¨ Elemento dialog encontrado:', dialog);
                if (dialog) {
                    dialog.style.display = 'flex';
                    console.log('ð¨ DiÃ¡logo de SDK mostrado');
                } else {
                    console.error('â No se encontrÃ³ el elemento compile-sdk-dialog');
                    resolve({ canceled: true });
                }
            });
        };
        
        window.showCompileOptionsDialog = function(sdkName) {
            console.log('âï¸ showCompileOptionsDialog llamada con SDK:', sdkName);
            return new Promise((resolve) => {
                console.log('âï¸ Configurando resolve para Options dialog');
                optionsDialogResolve = resolve;
                const dialog = document.getElementById('compile-options-dialog');
                console.log('âï¸ Elemento dialog encontrado:', dialog);
                if (dialog) {
                    // Actualizar tÃ­tulo con SDK seleccionado
                    const title = dialog.querySelector('.dialog-header h3');
                    if (title) {
                        title.textContent = `âï¸ Opciones de CompilaciÃ³n - ${sdkName}`;
                    }
                    dialog.style.display = 'flex';
                    console.log('âï¸ DiÃ¡logo de opciones mostrado para:', sdkName);
                } else {
                    console.error('â No se encontrÃ³ el elemento compile-options-dialog');
                    resolve({ canceled: true });
                }
            });
        };
        
        function closeCompileDialog() {
            const sdkDialog = document.getElementById('compile-sdk-dialog');
            if (sdkDialog) {
                sdkDialog.style.display = 'none';
            }
            if (sdkDialogResolve) {
                sdkDialogResolve({ canceled: true });
                sdkDialogResolve = null;
            }
        }
        
        function closeOptionsDialog() {
            const optionsDialog = document.getElementById('compile-options-dialog');
            if (optionsDialog) {
                optionsDialog.style.display = 'none';
            }
            if (optionsDialogResolve) {
                optionsDialogResolve({ canceled: true });
                optionsDialogResolve = null;
            }
        }
        
        // ===== VARIABLES GLOBALES =====
        let monacoInstance = null;
        let openFiles = new Map();
        let activeFile = null;
        let fileCounter = 1;
        
        // Variables para diÃ¡logos HTML
        let sdkDialogResolve = null;
        let optionsDialogResolve = null;
        
        // ===== FUNCIONES DE UTILIDAD =====
        function updateStatus(message, color = '#ffa500') {
            const statusElement = document.getElementById('editor-status');
            if (statusElement) {
                statusElement.textContent = message;
                statusElement.style.color = color;
            }
        }
        
        function addOutputLine(message, type = 'info') {
            const output = document.getElementById('output-content');
            if (output) {
                const line = document.createElement('div');
                line.className = 'output-line';
                line.style.color = type === 'success' ? '#4CAF50' : 
                                  type === 'error' ? '#F44336' : 
                                  type === 'warning' ? '#FF9800' : '#ffffff';
                line.textContent = message;
                output.appendChild(line);
                output.scrollTop = output.scrollHeight;
            }
        }
        
        // ===== FUNCIONES DE EDITOR =====
        window.getEditorContent = function() {
            return monacoInstance ? monacoInstance.getValue() : '';
        };
        
        window.setEditorContent = function(content) {
            if (monacoInstance) {
                monacoInstance.setValue(content || '');
            }
        };
        
        function createNewFile() {
            const fileName = `nuevo${fileCounter}.c`;
            const filePath = `temp://${fileName}`;
            const defaultContent = `#include <stdio.h>

int main() {
    printf("Â¡Hola desde SamaruC Code!\\n");
    printf("Archivo: ${fileName}\\n");
    return 0;
}`;
            
            fileCounter++;
            
            if (monacoInstance) {
                monacoInstance.setValue(defaultContent);
                updateStatus('Archivo creado', '#4CAF50');
                addOutputLine(`ð Archivo ${fileName} creado`, 'success');
            } else {
                addOutputLine('â Monaco Editor no disponible', 'error');
            }
        }
        
        function openFileInEditor(filePath, content, isNew = false) {
            if (monacoInstance) {
                monacoInstance.setValue(content || '');
                const fileName = filePath.split(/[\/\\]/).pop();
                updateStatus(`Archivo: ${fileName}`, '#4CAF50');
                addOutputLine(`ð Archivo ${fileName} abierto`, 'success');
            } else {
                addOutputLine('â Monaco Editor no disponible', 'error');
            }
        }
        
        // ===== CARGA DE MONACO EDITOR =====
        function loadMonacoEditor() {
            console.log('ð Intentando cargar Monaco Editor...');
            
            if (window.monaco) {
                console.log('â Monaco ya disponible');
                createMonacoEditor();
                return;
            }
            
            updateStatus('Cargando Monaco Editor...', '#2196F3');
            const basePath = window.location.href.replace('/src/index.html', '');
            console.log('ð Base path:', basePath);
            
            // Cargar CSS
            const css = document.createElement('link');
            css.rel = 'stylesheet';
            css.href = basePath + '/src/monaco/vs/editor/editor.main.css';
            css.onload = () => {
                console.log('â CSS de Monaco cargado');
                loadMonacoScript(basePath);
            };
            css.onerror = (error) => {
                console.error('â Error cargando CSS de Monaco:', error);
                showMonacoError('Error cargando CSS de Monaco');
            };
            document.head.appendChild(css);
        }
        
        function loadMonacoScript(basePath) {
            console.log('ð Cargando loader de Monaco...');
            const loader = document.createElement('script');
            loader.src = basePath + '/src/monaco/vs/loader.js';
            loader.onload = () => {
                console.log('â Loader de Monaco cargado');
                configureMonaco(basePath);
            };
            loader.onerror = (error) => {
                console.error('â Error cargando loader de Monaco:', error);
                showMonacoError('Error cargando loader de Monaco');
            };
            document.head.appendChild(loader);
        }
        
        function configureMonaco(basePath) {
            console.log('âï¸ Configurando Monaco...');
            
            if (typeof require === 'undefined') {
                console.error('â require no estÃ¡ disponible');
                showMonacoError('Entorno AMD no disponible');
                return;
            }
            
            require.config({ paths: { 'vs': basePath + '/src/monaco/vs' } });
            window.MonacoEnvironment = {
                getWorkerUrl: () => basePath + '/src/monaco/vs/base/worker/workerMain.js'
            };
            
            console.log('ð§ Cargando editor principal de Monaco...');
            require(['vs/editor/editor.main'], 
                () => {
                    console.log('â Monaco editor main cargado');
                    setTimeout(() => {
                        if (window.monaco) {
                            console.log('ð Monaco disponible, creando editor');
                            createMonacoEditor();
                        } else {
                            console.error('â Monaco no disponible despuÃ©s de cargar');
                            showMonacoError('Monaco no se cargÃ³ correctamente');
                        }
                    }, 500);
                },
                (error) => {
                    console.error('â Error cargando Monaco editor main:', error);
                    showMonacoError('Error cargando Monaco editor');
                }
            );
        }
        
        function createMonacoEditor() {
            console.log('ð¨ Creando instancia de Monaco Editor...');
            
            try {
                const container = document.getElementById('monaco-editor');
                if (!container) {
                    console.error('â Contenedor monaco-editor no encontrado');
                    showMonacoError('Contenedor no encontrado');
                    return;
                }
                
                console.log('ð¦ Contenedor encontrado, limpiando...');
                container.innerHTML = '';
                
                // Contenido inicial
                let initialContent = `#include <stdio.h>

int main() {
    printf("Â¡Hola desde SamaruC Code!\\n");
    return 0;
}`;
                
                console.log('ð§ Creando editor con window.monaco:', !!window.monaco);
                monacoInstance = window.monaco.editor.create(container, {
                    value: initialContent,
                    language: 'c',
                    theme: 'vs-dark',
                    fontSize: 14,
                    automaticLayout: true,
                    minimap: { enabled: true },
                    lineNumbers: 'on',
                    scrollBeyondLastLine: false,
                    wordWrap: 'on'
                });
                
                console.log('â Editor creado exitosamente');
                
                // Configurar evento de cambios
                monacoInstance.onDidChangeModelContent(() => {
                    // Detectar cambios en el cÃ³digo
                });
                
                // Exponer globalmente
                window.editor = monacoInstance;
                window.monacoInstance = monacoInstance;
                window.monaco = window.monaco;
                
                updateStatus('Monaco Editor activo', '#4CAF50');
                addOutputLine('â Monaco Editor funcionando', 'success');
                console.log('ð Monaco Editor completamente inicializado');
                
            } catch (error) {
                console.error('â Error creando Monaco Editor:', error);
                showMonacoError('Error creando editor: ' + error.message);
            }
        }
        
        function showMonacoError(errorMessage) {
            console.error('â ï¸ Error en Monaco Editor:', errorMessage);
            updateStatus('Error cargando Monaco', '#F44336');
            addOutputLine('â Error: ' + errorMessage, 'error');
            
            const container = document.getElementById('monaco-editor');
            if (container) {
                container.innerHTML = `
                    <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; color: #F44336; text-align: center; padding: 20px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">â ï¸</div>
                        <h3 style="color: #F44336; margin-bottom: 10px;">Error cargando Monaco Editor</h3>
                        <p style="color: #ffffff; margin-bottom: 20px;">${errorMessage}</p>
                        <button onclick="location.reload()" style="background: #007ACC; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-size: 14px;">
                            ð Reintentar
                        </button>
                    </div>
                `;
            }
        }
        
        // ===== FUNCIÃN DE TEST =====
        function testTerminalSwitch() {
            console.log('ð§ª === TEST TERMINAL SWITCH ===');
            console.log('1. switchPanel disponible:', !!window.switchPanel);
            console.log('2. Terminal panel existe:', !!document.getElementById('terminal-panel'));
            console.log('3. Panel tabs existen:', document.querySelectorAll('.panel-tab').length);
            
            // Intentar cambiar al terminal
            if (window.switchPanel) {
                console.log('ð Cambiando al terminal...');
                window.switchPanel('terminal');
            } else {
                console.log('â switchPanel no disponible');
            }
        }
        
        function debugTerminalStatus() {
            console.log('ð === DEBUG TERMINAL STATUS ===');
            console.log('Terminal module loaded:', !!window.terminal);
            console.log('Terminal initialized:', !!window.terminalInitialized);
            console.log('XTerm available:', typeof window.Terminal !== 'undefined');
        }
        
        // ===== FUNCIÃN DE DEBUG =====
        function debugEnvironment() {
            console.log('=== DEBUG ENVIRONMENT ===');
            console.log('window.require:', !!window.require);
            console.log('window.process:', !!window.process);
            console.log('window.electronAPI:', !!window.electronAPI);
            console.log('window.ipcRenderer:', !!window.ipcRenderer);
            
            if (window.process && window.process.versions) {
                console.log('Electron version:', window.process.versions.electron);
                console.log('Node version:', window.process.versions.node);
                console.log('Chrome version:', window.process.versions.chrome);
            }
            
            // Intentar inicializar IPC
            if (window.initializeElectronIpc) {
                const success = window.initializeElectronIpc();
                console.log('IPC initialization:', success);
            }
            
            console.log('========================');
        }
        
        // Exponer funciÃ³n de debug globalmente
        window.debugEnvironment = debugEnvironment;
        
        // ===== INICIALIZACIÃN =====
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ð DOM cargado, iniciando aplicaciÃ³n...');
            
            // Aplicar tema oscuro por defecto
            applyTheme('dark');
            
            updateStatus('Iniciando SamaruC Code...', '#2196F3');
            addOutputLine('ð SamaruC Code iniciado', 'success');
            
            // IMPORTANTE: Primero cargar Monaco, DESPUÃS crear pestaÃ±as
            console.log('ð Cargando Monaco PRIMERO...');
            loadMonacoEditor();
            
            // Inicializar explorador de archivos
            setTimeout(() => {
                if (window.updateFileExplorer) {
                    window.updateFileExplorer();
                    console.log('ð Explorador de archivos inicializado');
                }
                
                // Debug: Verificar estado del IPC
                if (window.initializeElectronIpc) {
                    const ipcStatus = window.initializeElectronIpc();
                    console.log('ð§ Estado del IPC:', ipcStatus ? 'Disponible' : 'No disponible');
                    
                    // Mostrar en la interfaz
                    const statusMsg = ipcStatus ? 
                        'â IPC disponible - Funcionalidad completa' : 
                        'â ï¸ IPC no disponible - Funcionalidad limitada';
                    window.addOutputLine?.(statusMsg, ipcStatus ? 'success' : 'warning');
                }
            }, 100);
            
            // ===== INICIALIZAR EVENT LISTENERS DE DIÃLOGOS =====
            // SDK Dialog - Event listeners
            const sdkOptions = document.querySelectorAll('.sdk-option');
            sdkOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const sdkId = this.dataset.sdk;
                    const sdkName = this.querySelector('strong').textContent;
                    
                    console.log('ð¦ SDK seleccionado:', sdkId, sdkName);
                    
                    // Cerrar diÃ¡logo
                    const dialog = document.getElementById('compile-sdk-dialog');
                    if (dialog) {
                        dialog.style.display = 'none';
                    }
                    
                    // Resolver promesa
                    if (sdkDialogResolve) {
                        sdkDialogResolve({ 
                            canceled: false, 
                            sdk: sdkId, 
                            name: sdkName 
                        });
                        sdkDialogResolve = null;
                    }
                });
            });
            
            // Options Dialog - Event listeners
            const compileOptions = document.querySelectorAll('.compile-option');
            compileOptions.forEach(option => {
                option.addEventListener('click', function() {
                    const optionId = this.dataset.option;
                    const optionName = this.querySelector('strong').textContent;
                    
                    console.log('âï¸ OpciÃ³n seleccionada:', optionId, optionName);
                    
                    // Cerrar diÃ¡logo
                    const dialog = document.getElementById('compile-options-dialog');
                    if (dialog) {
                        dialog.style.display = 'none';
                    }
                    
                    // Resolver promesa
                    if (optionsDialogResolve) {
                        optionsDialogResolve({ 
                            canceled: false, 
                            option: optionId, 
                            name: optionName 
                        });
                        optionsDialogResolve = null;
                    }
                });
            });
            
            // Cerrar diÃ¡logos al hacer clic fuera
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('dialog-overlay')) {
                    if (e.target.id === 'compile-sdk-dialog') {
                        closeCompileDialog();
                    } else if (e.target.id === 'compile-options-dialog') {
                        closeOptionsDialog();
                    }
                }
            });
        });
    </script>
    
    <!-- Scripts modulares -->
    <script src="renderer.js"></script>
    <script src="utils/ui.js"></script>
    <script src="file/fileManager.js"></script>
    <script src="events/events.js"></script>
    <script src="terminal/terminal.js"></script>
</body>
</html>
